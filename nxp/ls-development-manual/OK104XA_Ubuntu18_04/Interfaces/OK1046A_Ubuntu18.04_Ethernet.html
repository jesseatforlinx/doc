

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OK1046A-Ubuntun18.04_Ethernet &mdash; Forlinx Embedded LS Development Manual  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=30170994" />

  
    <link rel="shortcut icon" href="../../_static/forlinx.png"/>
    <link rel="canonical" href="https://forlinxembedded.github.io/nxp/ls-development-manual/OK104XA_Ubuntu18_04/Interfaces/OK1046A_Ubuntu18.04_Ethernet.html" />
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Interfaces" href="index.html" />
   

  <!-- Load Font Awesome from CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-N8EJPNL8NR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-N8EJPNL8NR');
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/forlinx-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">OK104XA Ubuntu18.04</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">OK104XA Ubuntu18.04 Development Manual</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Interfaces</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">OK1046A-Ubuntun18.04_Ethernet</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#copyright">Copyright</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-scope"><strong>Application Scope</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#revision-history"><strong>Revision History</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#serdes-configuration-scheme-modification">1. SerDes Configuration Scheme Modification</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Forlinx Embedded LS Development Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">OK104XA Ubuntu18.04 Development Manual</a></li>
          <li class="breadcrumb-item"><a href="index.html">Interfaces</a></li>
      <li class="breadcrumb-item active">OK1046A-Ubuntun18.04_Ethernet</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ok1046a-ubuntun18-04-ethernet">
<h1>OK1046A-Ubuntun18.04_Ethernet<a class="headerlink" href="#ok1046a-ubuntun18-04-ethernet" title="Link to this heading"></a></h1>
<p>Document classification: □ Top secret □ Secret □ Internal information ■ Open</p>
<section id="copyright">
<h2>Copyright<a class="headerlink" href="#copyright" title="Link to this heading"></a></h2>
<p>The copyright of this manual belongs to Baoding Folinx Embedded Technology Co., Ltd. Without the written permission of our company, no organizations or individuals have the right to copy, distribute, or reproduce any part of this manual in any form, and violators will be held legally responsible.</p>
<p>Forlinx adheres to copyrights of all graphics and texts used in all publications in original or license-free forms.</p>
<p>The drivers and utilities used for the components are subject to the copyrights of the respective manufacturers. The license conditions of the respective manufacturer are to be adhered to. Related license expenses for the operating system and applications should be calculated/declared separately by the related party or its representatives.</p>
</section>
<section id="application-scope">
<h2><strong>Application Scope</strong><a class="headerlink" href="#application-scope" title="Link to this heading"></a></h2>
<p>This software manual is designed for the LS1046 platform running Ubuntu 18.04. While other platforms may also reference this manual, there could be differences that require adjustments for the specific use.</p>
</section>
<section id="revision-history">
<h2><strong>Revision History</strong><a class="headerlink" href="#revision-history" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Date</strong></p></th>
<th class="head"><p><strong>Version</strong></p></th>
<th class="head"><p><strong>Revision H</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>11/05/2022</p></td>
<td><p>V1.0</p></td>
<td><p>Initial Version</p></td>
</tr>
</tbody>
</table>
</section>
<section id="serdes-configuration-scheme-modification">
<h2>1. SerDes Configuration Scheme Modification<a class="headerlink" href="#serdes-configuration-scheme-modification" title="Link to this heading"></a></h2>
<p>During the development process using LS1046, it is necessary to utilize various SerDes configuration schemes. This manual primarily discusses the software modifications.</p>
<p>Since the LS104x series development boards adopt the configuration method of the 【Reset configuration word】 (RCW), this method enables convenient definition of pin functions, i.e., realizes the PinMUX function of pins.</p>
<p>The SerDes Module unique to the LS104x platform also needs to be configured via RCW to assign different functions to different SerDes channels.</p>
<p>Taking the LS1046A as an example, the two configurable SerDes are:</p>
<p><img alt="Image" src="../../_images/1721975449529_ed2ec306_a89e_414f_885b_54f6e3cb0f00.png" /></p>
<p><img alt="Image" src="../../_images/1721975410147_9f322c8f_c0b7_4e01_91e5_933c00d44fbd.png" /></p>
<p>However, the configuration method called RCW is not well - known. So, this manual takes an actual requirement of the LS1046A as an example to elaborate on the modification process for subsequent customization reference.</p>
<p>Forlinx offers two SerDes configuration schemes, namely 1040_5559 and 1133_5559. Corresponding to the functions in the above table, the functions of these two SerDes are respectively:</p>
<p>1040_5559：</p>
<p><img alt="Image" src="../../_images/1721975533908_74841a28_9af7_46cd_b37b_dccc04a84f5d.png" /></p>
<p>You can see that there is one XFI for MAC 9, one QSGMII for MAC6, MAC5, MAC10, and MAC1, and in addition, there are three PCIe x1 interfaces.</p>
<p>1133_5559：</p>
<p><img alt="Image" src="../../_images/1721975596632_96a31e09_0af0_44d5_9f17_314d686f4c7c.png" /></p>
<p>You can see that there is one XFI for MAC 9, one XFI for MAC10, one SGMII for MAC5, one SGMII for MAC6, and in addition, there are three PCIe x1 interfaces.</p>
<p>At this time, if a project requires 5 network ports: one is the RGMII network port built - in the SoM, and the other four are SGMII network ports led out by SerDes. It is found that the two SerDes configurations provided by Forlinx do not meet the requirements. Then, after consulting the SerDes configuration table, it is found that 1333_5a59 can meet the requirements:</p>
<p><img alt="Image" src="../../_images/1721975646431_b9af15a9_e581_4ab5_972f_92414ae3c442.png" /></p>
<p><font style="color:rgb(51,51,51);background-color:rgb(255,255,255);">Then, the configuration modification will be carried out with this as an example.</font><font style="color:rgb(51,51,51);background-color:rgb(255,255,255);">。</font></p>
<p>First, sort out the corresponding relationship between PHY and MAC in the project:</p>
<p><img alt="Image" src="../../_images/1721975678982_0734fd2f_9f91_420a_b1b1_29faa41b2a61.png" /></p>
<p>First of all, it is necessary to know that the locations of the two RCW files of OK1046A - C in the source code are:</p>
<p>flexbuild/packages/firmware/rcw/ls1046ardb/FORLINX/rcw_1800_qspiboot_1040_5559.rcw</p>
<p>flexbuild/packages/firmware/rcw/ls1046ardb/FORLINX/rcw_1800_qspiboot_1133_5559.rcw</p>
<p>For the convenience of development, modifications are made based on rcw_1800_qspiboot_1133_5559.rcw.</p>
<section id="rcw-configuration-modification">
<h3><strong>1.1 RCW Configuration Modification</strong><a class="headerlink" href="#rcw-configuration-modification" title="Link to this heading"></a></h3>
<p>First, modify the RCW configuration to 1333_5a59, and respectively modify the values of SRDS_PRTCL_S1 and SRDS_PRTCL_S2. Here, convert hexadecimal to decimal. For example, the decimal value of 0x1333 is 4915, and the decimal value of 0x5a59 is 23129.</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>---a/flexbuild/packages/firmware/rcw/ls1046ardb/FORLINX/rcw_1800_qspiboot_1133_5559.rcw
+++b/flexbuild/packages/firmware/rcw/ls1046ardb/FORLINX/rcw_1800_qspiboot_1133_5559.rcw
@@ -69,8 +69,8 @@ SYS_PLL_RAT=7
MEM_PLL_RAT=21
CGA_PLL1_RAT=18
CGA_PLL2_RAT=16
-SRDS_PRTCL_S1=4403
-SRDS_PRTCL_S2=21849
+SRDS_PRTCL_S1=4915
+SRDS_PRTCL_S2=23129
SRDS_PLL_REF_CLK_SEL_S1=1
SRDS_PLL_REF_CLK_SEL_S2=0
SRDS_DIV_PEX_S1=1
@@ -88,7 +88,7 @@ SPI_EXT=1
SPI_BASE=2
</pre></div>
</div>
</section>
<section id="uboot-configuration-modification">
<h3><strong>1.2 Uboot Configuration Modification</strong><a class="headerlink" href="#uboot-configuration-modification" title="Link to this heading"></a></h3>
<p>First, add the definition of the required PHY address in the header file.</p>
<p>The location of this file in the source code is:</p>
<p>flexbuild/packages/firmware/u-boot/include/configs/ls1046ardb.h</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>--- a/include/configs/ls1046ardb.h
+++ b/include/configs/ls1046ardb.h
@@ -179,7 +179,10 @@
#define RGMII_PHY1_ADDR                        0x1
#define RGMII_PHY2_ADDR                        0x2

-#define SGMII_PHY2_ADDR                        0x3
+#define SGMII_PHY1_ADDR                        0x2
+#define SGMII_PHY2_ADDR                        0x5
+#define SGMII_PHY3_ADDR                        0x3
+#define SGMII_PHY4_ADDR                        0x4

#define QSGMII_PORT1_PHY_ADDR          8
#define QSGMII_PORT2_PHY_ADDR          9
</pre></div>
</div>
<p>The location of the network initialization code of Uboot in the source code is:</p>
<p>flexbuild/packages/firmware/u-boot/board/freescale/ls1046ardb/eth.c</p>
<p>At this time, the configuration of the network part needs to be modified.</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>--- a/board/freescale/ls1046ardb/eth.c
+++ b/board/freescale/ls1046ardb/eth.c
@@ -35,28 +35,33 @@ int board_eth_init(bd_t *bis)
/* Register the 1G MDIO bus */
fm_memac_mdio_init(bis, &amp;dtsec_mdio_info);


+       /*
+       //Comment out the definition of the MDIO bus of the 10 Gigabit network on the original carrier board
        tgec_mdio_info.regs =
                (struct memac_mdio_controller *)CONFIG_SYS_FM1_TGEC_MDIO_ADDR;
        tgec_mdio_info.name = DEFAULT_FM_TGEC_MDIO_NAME;
+       */


/* Register the 10G MDIO bus */
-       fm_memac_mdio_init(bis, &amp;tgec_mdio_info);
+       //Comment out the initialization of the MDIO bus for the original 10-gigabit network on the original carrier board
+       /*fm_memac_mdio_init(bis, &amp;tgec_mdio_info);*/


/* Set the two on-board RGMII PHY address */
        fm_info_set_phy_address(FM1_DTSEC3, RGMII_PHY1_ADDR);
-       fm_info_set_phy_address(FM1_DTSEC4, RGMII_PHY2_ADDR);
+       //Comment out the binding of MAC and PHY for the RGMII network port of MAC4 on the original carrier board
+       //fm_info_set_phy_address(FM1_DTSEC4, RGMII_PHY2_ADDR);


/* Set the on-board AQ PHY address */
-       fm_info_set_phy_address(FM1_10GEC1, FM1_10GEC1_PHY_ADDR);
+       //Comment out the binding of MAC and PHY for the 10-gigabit network port on the carrier board
+       //fm_info_set_phy_address(FM1_10GEC1, FM1_10GEC1_PHY_ADDR);


        switch (srds_s1) {
+       //Modify the SGMII network-related configuration of SerDes
-       case 0x1133:
+       case 0x1333:
        /* Set the two on-board SGMII PHY address */
        //fm_info_set_phy_address(FM1_DTSEC5, SGMII_PHY1_ADDR);
        //Disable MAC5 and bind MAC6 to its associated PHY address
-               fm_disable_port(FM1_DTSEC5);
-               fm_info_set_phy_address(FM1_DTSEC6, SGMII_PHY2_ADDR);
-               run_command(&quot;setenv serdes1 1133&quot;, 0);
+               fm_disable_port(FM1_DTSEC4);
+               //Bind MAC10, MAC5, MAC6, and MAC2 to their respective associated PHY addresses
+               fm_info_set_phy_address(FM1_DTSEC10, SGMII_PHY1_ADDR);
+               fm_info_set_phy_address(FM1_DTSEC5, SGMII_PHY2_ADDR);
+               fm_info_set_phy_address(FM1_DTSEC6, SGMII_PHY3_ADDR);
+               fm_info_set_phy_address(FM1_DTSEC2, SGMII_PHY4_ADDR);
+               //Set the environment variable serdes1 to 1333.
+               run_command(&quot;setenv serdes1 1333&quot;, 0);
                break;
        case 0x1040:
                /* QSGMII on lane B, MAC 6/5/10/1 */
@@ -81,9 +86,11 @@ int board_eth_init(bd_t *bis)
                fm_info_set_mdio(i, dev);
        /* XFI on lane A, MAC 9 */
+       /*
+       //Comment out the registration of the mounted MAC on the MDIO bus for the 10-gigabit network on the original carrier board
        dev = miiphy_get_dev_by_name(DEFAULT_FM_TGEC_MDIO_NAME);
        fm_info_set_mdio(FM1_10GEC1, dev);
-
+       */
        cpu_eth_init(bis);
#endif
</pre></div>
</div>
<p>After modifying this part, the code modification of the network configuration in the Uboot part is completed.</p>
</section>
<section id="device-tree-modification">
<h3><strong>1.3 Device Tree Modification</strong><a class="headerlink" href="#device-tree-modification" title="Link to this heading"></a></h3>
<p><strong>Note: Please refer to the actual device tree path when making modifications.</strong></p>
<p>First, it is necessary to know the locations of the device tree files corresponding to the two RCW configurations of OK1046A - C in the source code.</p>
<p>flexbuild/packages/linux/linux/arch/arm64/boot/dts/freescale/fsl-ls1046a-rdb-sdk-1040-5559.dts</p>
<p>flexbuild/packages/linux/linux/arch/arm64/boot/dts/freescale/fsl-ls1046a-rdb-sdk-1133-5559.dts</p>
<p>The device tree can also be modified based on fsl-ls1046a-rdb-sdk-1133-5559.dts. First, the Makefile of the device tree needs to be modified to add the compilation of the required DTS file.</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>--- a/arch/arm64/boot/dts/freescale/Makefile
+++ b/arch/arm64/boot/dts/freescale/Makefile
@@ -14,6 +14,7 @@ dtb-$(CONFIG_ARCH_LAYERSCAPE) += fsl-ls1046a-qds-sdk.dtb
dtb-$(CONFIG_ARCH_LAYERSCAPE) += fsl-ls1046a-rdb.dtb
dtb-$(CONFIG_ARCH_LAYERSCAPE) += fsl-ls1046a-rdb-sdk.dtb
dtb-$(CONFIG_ARCH_LAYERSCAPE) += fsl-ls1046a-rdb-sdk-1133-5559.dtb
+dtb-$(CONFIG_ARCH_LAYERSCAPE) += fsl-ls1046a-rdb-sdk-1333-5a59.dtb
dtb-$(CONFIG_ARCH_LAYERSCAPE) += fsl-ls1046a-rdb-sdk-1040-5559.dtb
dtb-$(CONFIG_ARCH_LAYERSCAPE) += fsl-ls1046a-rdb-usdpaa-1133-5559.dtb
dtb-$(CONFIG_ARCH_LAYERSCAPE) += fsl-ls1046a-rdb-usdpaa-1040-5559.dtb
</pre></div>
</div>
<p>Secondly, copy and rename the dts file, and execute the command.</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>cp flexbuild/packages/linux/linux/arch/arm64/boot/dts/freescale/fsl-ls1046a-rdb-sdk-1133-5559.dts 
   flexbuild/packages/linux/linux/arch/arm64/boot/dts/freescale/fsl-ls1046a-rdb-sdk-1333-5a59.dts
</pre></div>
</div>
<p>Next, modify the fsl-ls1046a-rdb-sdk-1333-5a59.dts file.</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>--- arch/arm64/boot/dts/freescale/fsl-ls1046a-rdb-sdk-1333-5a59.dts
+++ arch/arm64/boot/dts/freescale/fsl-ls1046a-rdb-sdk-1333-5a59.dts
@@ -54,8 +54,9 @@
        };
        
+       /* Enable MAC2, register it with the interface as SGMII, and set the PHY address to sgmii_phy4 (i.e., 4)
        ethernet@e2000 {
-               status = &quot;disabled&quot;;
-       };
+               phy-handle = &lt;&amp;sgmii_phy4&gt;;
+               phy-connection-type = &quot;sgmii&quot;;
+       };


        ethernet@e4000 {
                phy-handle = &lt;&amp;rgmii_phy1&gt;;
@@ -63,27 +64,26 @@
        };

        
+       /* Disable MAC4 */
        ethernet@e6000 {
-               phy-handle = &lt;&amp;rgmii_phy2&gt;;
-               phy-connection-type = &quot;rgmii-txid&quot;;
+               status = &quot;disabled&quot;;
        };

        
+       /* Enable MAC5, register it with the SGMII interface, and set the PHY address to sgmii_phy2 (i.e., 5)
         ethernet@e8000 {
-               status = &quot;disabled&quot;;
-       };
+               phy-handle = &lt;&amp;sgmii_phy2&gt;;
+               phy-connection-type = &quot;sgmii&quot;;
+        };


+       /* Enable MAC6, register it with the SGMII interface, and set the PHY address to sgmii_phy3 (i.e., 3)
        ethernet@ea000 {
-               phy-handle = &lt;&amp;sgmii_phy2&gt;;
+               phy-handle = &lt;&amp;sgmii_phy3&gt;;
                phy-connection-type = &quot;sgmii&quot;;
        };

        
+       /* Disable MAC9, i.e., disable the 10-gigabit network interface on the carrier board */
-       ethernet@f0000 { /* 10GEC1 */
-               phy-handle = &lt;&amp;aqr105_phy&gt;;
-               phy-connection-type = &quot;xgmii&quot;;
+       ethernet@f0000 {
+               status = &quot;disabled&quot;;
        };

        
+       /* Enable MAC10, register it with the SGMII interface, and set the PHY address to sgmii_phy1 (i.e., 2) */
-       ethernet@f2000 { /* 10GEC2 */
-               fixed-link = &lt;0 1 1000 0 0&gt;;
-               phy-connection-type = &quot;xgmii&quot;;
+       ethernet@f2000 {
+               phy-handle = &lt;&amp;sgmii_phy1&gt;;
+               phy-connection-type = &quot;sgmii&quot;;
        };

        
        mdio@fc000 {
@@ -91,20 +91,21 @@
                     reg = &lt;0x1&gt;;
        };

        
+               /* Modify PHY address */
-               rgmii_phy2: ethernet-phy@2 {
-                       reg = &lt;0x2&gt;;
-               };
+               sgmii_phy1: ethernet-phy@2 {
+                        reg = &lt;0x2&gt;;
+               };

-               sgmii_phy2: ethernet-phy@3 {
-                       reg = &lt;0x3&gt;;
+               sgmii_phy2: ethernet-phy@5 {
+                       reg = &lt;0x5&gt;;
+
+               sgmii_phy3: ethernet-phy@3 {
+                        reg = &lt;0x3&gt;;
+                };
+
+               sgmii_phy4: ethernet-phy@4 {
+                        reg = &lt;0x4&gt;;
+                };
         };

         
+       /* Disable MDIO for 10 Gigabit Network */
-       mdio@fd000 {
-               aqr105_phy: ethernet-phy@0 {
-                       compatible = &quot;ethernet-phy-ieee802.3-c45&quot;;
-                       reg = &lt;0x0&gt;;
-               };
         };
};


@@ -130,13 +131,15 @@
        ethernet@0 {
                status = &quot;disabled&quot;;
        };
+       /*Modify dpaa configuration, disable MAC1, MAC4 and MAC9, and enable MAC2，MAC3，MAC5，MAC6，MAC10*/
-       ethernet@1 {
+       ethernet@3 {
                status = &quot;disabled&quot;;
        };
-       ethernet@4 {
-               status = &quot;disabled&quot;;
-       };
-
+       ethernet@8 {
+               status = &quot;disabled&quot;;
+        };
        ethernet@9 {
                compatible = &quot;fsl,dpa-ethernet&quot;;
                fsl,fman-mac = &lt;&amp;enet7&gt;;
</pre></div>
</div>
<p>At this point, the code modification of the device tree part is completed.</p>
<p>The complete source code of the modified device tree is as follows:</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>#include &quot;fsl-ls1046a-rdb.dts&quot;
#include &quot;qoriq-qman-portals-sdk.dtsi&quot;
#include &quot;qoriq-bman-portals-sdk.dtsi&quot;

&amp;fman0 {
       ethernet@e0000 {
               status = &quot;disabled&quot;;
       };
       
       ethernet@e2000 {
               phy-handle = &lt;&amp;sgmii_phy4&gt;;
               phy-connection-type = &quot;sgmii&quot;;
       };
       
       ethernet@e4000 {
               phy-handle = &lt;&amp;rgmii_phy1&gt;;
               phy-connection-type = &quot;rgmii-txid&quot;;
       };
       
      ethernet@e6000 {
               status = &quot;disabled&quot;;
       };
       
      ethernet@e8000 {
               phy-handle = &lt;&amp;sgmii_phy2&gt;;
               phy-connection-type = &quot;sgmii&quot;;
       };
       
      ethernet@ea000 {
               phy-handle = &lt;&amp;sgmii_phy3&gt;;
               phy-connection-type = &quot;sgmii&quot;;
       };
       
      ethernet@f0000 {
               status = &quot;disabled&quot;;
       };
       
      ethernet@f2000 {
               phy-handle = &lt;&amp;sgmii_phy1&gt;;
               phy-connection-type = &quot;sgmii&quot;;
       };
       
      mdio@fc000 {
               rgmii_phy1: ethernet-phy@1 {
                        reg = &lt;0x1&gt;;
               };
       
               sgmii_phy1: ethernet-phy@2 {
                        reg = &lt;0x2&gt;;
               };
       
               sgmii_phy2: ethernet-phy@5 {
                        reg = &lt;0x5&gt;;
               };
       
               sgmii_phy3: ethernet-phy@3 {
                        reg = &lt;0x3&gt;;
               };
       
                sgmii_phy4: ethernet-phy@4 {
                        reg = &lt;0x4&gt;;
               };
      };
};

&amp;bman_fbpr {
       compatible = &quot;fsl,bman-fbpr&quot;;
       alloc-ranges = &lt;0 0 0x10000 0&gt;;
};

&amp;qman_fqd {
       compatible = &quot;fsl,qman-fqd&quot;;
       alloc-ranges = &lt;0 0 0x10000 0&gt;;
};

&amp;qman_pfdr {
       compatible = &quot;fsl,qman-pfdr&quot;;
       alloc-ranges = &lt;0 0 0x10000 0&gt;;
};

&amp;soc {
       #include &quot;qoriq-dpaa-eth.dtsi&quot;
       #include &quot;qoriq-fman3-0-6oh.dtsi&quot;
};

&amp;fsldpaa {
         ethernet@0 {
                 status = &quot;disabled&quot;;
         };
        ethernet@3 {
                 status = &quot;disabled&quot;;
         };
        ethernet@8 {
                status = &quot;disabled&quot;;
         };
         ethernet@9 {
                 compatible = &quot;fsl,dpa-ethernet&quot;;
                 fsl,fman-mac = &lt;&amp;enet7&gt;;
                 dma-coherent;
         };
};

&amp;fman0 {
       compatible = &quot;fsl,fman&quot;, &quot;simple-bus&quot;;
};
</pre></div>
</div>
</section>
<section id="flex-build-compilation-tool-modification">
<h3><strong>1.4 Flex - build Compilation Tool Modification</strong><a class="headerlink" href="#flex-build-compilation-tool-modification" title="Link to this heading"></a></h3>
<p>Since a device tree file is added and the SerDes configuration in the RCW part is modified, there will be some problems when the flex - build compilation tool creates the burning image, and corresponding modifications are required.</p>
<p>This part mainly involves Uboot selecting and loading the corresponding dts device tree file by reading the serdes1 parameter in the environment variable.</p>
<p>The location of the relevant file in the source code is:</p>
<p>flexbuild/configs/board/ls1046ardb/manifest</p>
<p>The modification content is:</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>--- a/flexbuild/configs/board/ls1046ardb/manifest
+++ b/flexbuild/configs/board/ls1046ardb/manifest
@@ -39,7 +39,7 @@ securevalidate_enc=&quot;setenv secureboot_validate &#39;load \$devtype \$devnum:2 \$kern
securevalidate_dec=&quot;setenv secureboot_validate &#39;size \$devtype \$devnum:2 /Image;setexpr imgsize \$filesize - 0x30 ;echo Decapsulating linux image; setenv key_addr 0x87000000; mw \$key_addr $key_id_1;setexpr \$key_addr \$key_addr + 0x4; mw \$key_addr $key_id_2;setexpr \$key_addr \$key_addr + 0x4; mw \$key_addr key_id_3;setexpr \$key_addr \$key_addr + 0x4; mw \$key_addr $key_id_4; blob dec \$kernel_addr_r \$load_addr \$imgsize \$key_addr; cp.b \$load_addr \$kernel_addr_r \$filesize ;size \$devtype \$devnum:2 /fsl-ls1046a-rdb-sdk.dtb;setexpr imgsize \$filesize - 0x30 ;echo Decapsulating dtb image; blob dec \$fdt_addr_r \$load_addr \$imgsize \$key_addr; cp.b \$load_addr \$fdt_addr_r \$filesize ; &#39;&quot;
-distroboot=&#39;part uuid $devtype $devnum:3 partuuid3; setenv bootargs console=ttyS0,115200 earlycon=uart8250,mmio,0x21c0500 root=PARTUUID=$partuuid3 rw rootwait $othbootargs; if load $devtype $devnum:2 $load_addr /boot/uEnv.txt; then echo Importing environment from uEnv.txt ...; env import -t $load_addr $filesize; fi; load $devtype $devnum:2 $kernel_addr_r /boot/Image;load $devtype $devnum:2 $fdt_addr_r /boot/fsl-ls1046a-rdb-sdk-$serdes1-5559.dtb; env exists secureboot &amp;&amp; echo validating secureboot &amp;&amp; run secureboot_validate;booti $kernel_addr_r - $fdt_addr_r&#39;
+distroboot=&#39;part uuid $devtype $devnum:3 partuuid3; setenv bootargs console=ttyS0,115200 earlycon=uart8250,mmio,0x21c0500 root=PARTUUID=$partuuid3 rw rootwait $othbootargs; if load $devtype $devnum:2 $load_addr /boot/uEnv.txt; then echo Importing environment from uEnv.txt ...; env import -t $load_addr $filesize; fi; load $devtype $devnum:2 $kernel_addr_r /boot/Image;load $devtype $devnum:2 $fdt_addr_r /boot/fsl-ls1046a-rdb-sdk-$serdes1-5a59.dtb; env exists secureboot &amp;&amp; echo validating secureboot &amp;&amp; run secureboot_validate;booti $kernel_addr_r - $fdt_addr_r&#39;
</pre></div>
</div>
<p>Modify fsl-ls1046a-rdb-sdk-$serdes1-5559.dtb to fsl-ls1046a-rdb-sdk-$serdes1-5a59.dtb.</p>
<p>Secondly, modify the flex - builder source code to copy the newly added dtb file to the generated image path.</p>
<p>The location of the relevant file in the source code is: flexbuild/tools/flex - builder</p>
<p>The modification content is:</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>--- a/flexbuild/tools/flex-builder
+++ b/flexbuild/tools/flex-builder
@@ -459,7 +459,7 @@ gen_bootpart() {
if [ &quot;$MACHINE&quot; = &quot;ls1046ardb&quot; ]; then
cp $FBDIR/build/linux/linux/arm64/Image $FBDIR/build/images/boot
-       cp $FBDIR/build/linux/linux/arm64/fsl-ls1046a-rdb-sdk-1133-5559.dtb $FBDIR/build/images/boot
+       cp $FBDIR/build/linux/linux/arm64/fsl-ls1046a-rdb-sdk-1333-5a59.dtb $FBDIR/build/images/boot
cp $FBDIR/build/linux/linux/arm64/fsl-ls1046a-rdb-sdk-1040-5559.dtb $FBDIR/build/images/boot
cp $FBDIR/build/firmware/u-boot/ls1046ardb/ls1046ardb_boot.scr $FBDIR/build/images/boot
cp $FBDIR/build/firmware/u-boot/ls1046ardb/ls1046ardb_update.scr $FBDIR/build/images
</pre></div>
</div>
<p>At this point, all the code modifications of the network part are completed.</p>
<p>Then, the system can be compiled by referring to the compilation section of the software manual, and then the system can be updated using a USB flash drive for use.</p>
</section>
</section>
</section>


           </div>
          </div>
          <div class="forlinx-footer-social" style="margin-top: 15px; padding: 0 16px;">
  <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">

    <!-- 左侧版权信息 -->
    <span style="font-size: 14px; color: #444;">
      © <a href="https://www.forlinx.net/" target="_blank" style="color: inherit; text-decoration: none;">Forlinx Embedded</a>
    </span>

    <!-- 右侧社交图标 -->
    <div>
      <a href="https://www.facebook.com/Forlinx-Embedded-177890724336237" target="_blank">
        <i class="fab fa-facebook fa-lg" style="margin: 0 6px; color:#3b5998;"></i>
      </a>
      <a href="https://www.linkedin.com/company/forlinx-embedded-technology-co-ltd/" target="_blank">
        <i class="fab fa-linkedin fa-lg" style="margin: 0 6px; color:#0077b5;"></i>
      </a>
      <a href="https://x.com/ForlinxOfficial" target="_blank">
        <i class="fab fa-x-twitter fa-lg" style="margin: 0 6px; color:#000;"></i>
      </a>
      <a href="https://www.youtube.com/@forlinxembedded" target="_blank">
        <i class="fab fa-youtube fa-lg" style="margin: 0 6px; color:#FF0000;"></i>
      </a>
      <a href="https://github.com/ForlinxEmbedded" target="_blank">
        <i class="fab fa-github fa-lg" style="margin: 0 6px; color:#333;"></i>
      </a>
      <a href="https://www.forlinx.net/" target="_blank">
        <i class="fas fa-globe fa-lg" style="margin: 0 6px; color:#2274A5;"></i>
      </a>
    </div>

  </div>
</div>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>